#!/bin/bash

# Kubernetes Setup Script for messaging_app

echo "=== Kubernetes Cluster Setup Script ==="
echo ""

# Check if minikube is installed
echo "Checking if minikube is installed..."
if ! command -v minikube &> /dev/null; then
    echo "Error: minikube is not installed"
    echo "Please install minikube from: https://minikube.sigs.k8s.io/docs/start/"
    exit 1
fi
echo "✓ minikube is installed"
echo ""

# Check if kubectl is installed
echo "Checking if kubectl is installed..."
if ! command -v kubectl &> /dev/null; then
    echo "Error: kubectl is not installed"
    echo "Please install kubectl from: https://kubernetes.io/docs/tasks/tools/"
    exit 1
fi
echo "✓ kubectl is installed"
echo ""

# Start minikube cluster
echo "Starting Kubernetes cluster with minikube..."
minikube start
if [ $? -ne 0 ]; then
    echo "Error: Failed to start minikube cluster"
    exit 1
fi
echo "✓ Kubernetes cluster started successfully"
echo ""

# Verify cluster is running
echo "Verifying cluster status..."
kubectl cluster-info
if [ $? -ne 0 ]; then
    echo "Error: Cluster is not running properly"
    exit 1
fi
echo "✓ Cluster is running"
echo ""

# Get cluster nodes
echo "Retrieving cluster nodes..."
kubectl get nodes
echo ""

# Get available pods
echo "Retrieving available pods..."
kubectl get pods --all-namespaces
echo ""

echo "=== Kubernetes cluster setup complete! ==="
echo "You can now deploy your application to the cluster."